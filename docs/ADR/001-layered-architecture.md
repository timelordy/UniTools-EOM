# ADR-001: –°–ª–æ–µ–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Clean Architecture)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∏–Ω—è—Ç–æ

**–î–∞—Ç–∞:** 2024-2026 (—ç–≤–æ–ª—é—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞)

**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∫–æ–¥ –≤ pyRevit —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ –Ω–∞ 10,000+ LOC?

---

## –ü—Ä–æ–±–ª–µ–º–∞

–ë–µ–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã pyRevit-—Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ monolithic spaghetti code:

```python
# ‚ùå –¢–∏–ø–∏—á–Ω—ã–π pyRevit script (–ø–ª–æ—Ö–æ)
from pyrevit import DB, revit, forms

doc = revit.doc

# 2000 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ:
# - Revit API calls
# - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
# - UI –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
# - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
# - –í—Å—ë –≤–º–µ—Å—Ç–µ!
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (Revit API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤–Ω–µ Revit)
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –º–µ–∂–¥—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏
- –°–ª–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –±–∞–≥–∏
- –ù–æ–≤–∏—á–∫–∏ –Ω–µ –ø–æ–Ω–∏–º–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É

---

## –†–µ—à–µ–Ω–∏–µ

–ü—Ä–∏–Ω—è—Ç—å **Clean Architecture** —Å —è–≤–Ω—ã–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ —Å–ª–æ–∏:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Script Layer (script.py)           ‚îÇ  ‚Üê Entry point, error handling
‚îÇ  ‚Ä¢ <50 LOC                          ‚îÇ
‚îÇ  ‚Ä¢ –¢–æ–ª—å–∫–æ –≤—ã–∑–æ–≤ orchestrator        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Orchestrator Layer                 ‚îÇ  ‚Üê –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è workflow
‚îÇ  (orchestrator.py)                  ‚îÇ
‚îÇ  ‚Ä¢ Progress bars                    ‚îÇ
‚îÇ  ‚Ä¢ Batch processing                 ‚îÇ
‚îÇ  ‚Ä¢ Transaction management           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ                ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Adapters   ‚îÇ   ‚îÇ   Domain     ‚îÇ    ‚Üê –ß–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ  (Revit API)‚îÇ   ‚îÇ   (Pure)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Shared Kernel (lib/)               ‚îÇ  ‚Üê –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥—É–ª–∏
‚îÇ  ‚Ä¢ placement_engine.py              ‚îÇ
‚îÇ  ‚Ä¢ socket_utils.py                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°–ª–æ–∏

#### 1. **Domain Layer** (`domain.py`)
- –ß–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- –ù–∏–∫–∞–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç Revit API
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

```python
# domain.py
def solid_centroid(elem):
    """Volume-weighted centroid calculation."""
    total_vol = 0.0
    sx = sy = sz = 0.0
    for solid in iter_solids(geom):
        c = solid.ComputeCentroid()
        v = float(solid.Volume)
        total_vol += v
        sx += float(c.X) * v
        # ...
    return DB.XYZ(sx / total_vol, sy / total_vol, sz / total_vol)
```

#### 2. **Adapters Layer** (`adapters.py`)
- –ê–¥–∞–ø—Ç–µ—Ä—ã –∫ Revit API
- UI dialogs
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü

```python
# adapters.py
def pick_light_symbol(doc, cfg, type_names):
    """Adapter: –≤—ã–±—Ä–∞—Ç—å —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–ª–∏ UI."""
    # 1. –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ –ø–æ ID
    # 2. –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏
    # 3. UI dialog
    return symbol
```

#### 3. **Orchestrator Layer** (`orchestrator.py`)
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è workflow
- –í—ã–∑–æ–≤ domain + adapters
- Progress bars, batching

```python
# orchestrator.py
def run_placement(doc, output, script):
    # 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥
    # 2. –í—ã–±—Ä–∞—Ç—å —Å–∏–º–≤–æ–ª (adapter)
    # 3. –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ (adapter)
    # 4. –í—ã—á–∏—Å–ª–∏—Ç—å —Ç–æ—á–∫–∏ (domain)
    # 5. –†–∞–∑–º–µ—Å—Ç–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã (adapter + batch)
    # 6. –û—Ç—á—ë—Ç
```

#### 4. **Script Layer** (`script.py`)
- –¢–æ–Ω–∫–∏–π entry point (<50 LOC)
- Error handling
- Integration —Å Hub

```python
# script.py
try:
    result = orchestrator.run_placement(doc, output, script)
except Exception:
    log_exception('Tool failed')
    alert('–û—à–∏–±–∫–∞. –°–º. pyRevit Output.')
```

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ 1: Monolithic script
**–ü–ª—é—Å—ã:** –ü—Ä–æ—â–µ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö
**–ú–∏–Ω—É—Å—ã:** –ù–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ 2: MVC (Model-View-Controller)
**–ü–ª—é—Å—ã:** –ü—Ä–∏–≤—ã—á–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω
**–ú–∏–Ω—É—Å—ã:** pyRevit –Ω–µ –∏–º–µ–µ—Ç —è–≤–Ω–æ–π "View" (UI –≤—Å—Ç—Ä–æ–µ–Ω –≤ Revit)

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ 3: –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
**–ü–ª—é—Å—ã:** –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è
**–ú–∏–Ω—É—Å—ã:** Overkill –¥–ª—è pyRevit, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –¥–µ–ø–ª–æ—è

---

## –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

### ‚úÖ –ü–ª—é—Å—ã

1. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: domain-–ª–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ Revit
2. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: Shared Kernel –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
3. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: —è–≤–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
4. **Onboarding**: –Ω–æ–≤–∏—á–∫–∏ –±—ã—Å—Ç—Ä–µ–µ –ø–æ–Ω–∏–º–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É

### ‚ö†Ô∏è –ú–∏–Ω—É—Å—ã

1. **Boilerplate**: 4 —Ñ–∞–π–ª–∞ –≤–º–µ—Å—Ç–æ 1 (–Ω–æ –∫–∞–∂–¥—ã–π < 500 LOC)
2. **Learning curve**: –Ω–∞–¥–æ –∑–Ω–∞—Ç—å Clean Architecture

### üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è

Legacy –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä—è—Ç—Å—è:
- ‚úÖ `–°–≤–µ—Ç–í–õ–∏—Ñ—Ç–∞—Ö` - —É–∂–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–Ω—É—Ç
- üöß `–©–≠–í–ù–∏—à–∞—Ö` - –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ (3977 LOC ‚Üí 4 –º–æ–¥—É–ª—è)

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

- [ADR-002: –§—É–Ω–∫—Ü–∏–∏ –≤–º–µ—Å—Ç–æ –∫–ª–∞—Å—Å–æ–≤](002-functions-over-classes.md)
- [ADR-003: Batch processing](003-batch-transactions.md)

---

**–ê–≤—Ç–æ—Ä:** anton
**–î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è:** 2024-Q1 (—ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–æ)
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-02-09
