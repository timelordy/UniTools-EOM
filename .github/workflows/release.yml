 name: Release
 
 on:
   push:
     tags:
       - 'v*'
 
 permissions:
   contents: write
 
 jobs:
   release:
     runs-on: ubuntu-latest
     
     steps:
       - uses: actions/checkout@v4
       
       - name: Get version from tag
         id: get_version
         run: echo "VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT
       
       - name: Extract changelog for this version
         id: changelog
         run: |
           VERSION=${{ steps.get_version.outputs.VERSION }}
           # Extract section for this version from CHANGELOG.md
           awk "/## \[${VERSION}\]/{flag=1; next} /## \[/{flag=0} flag" CHANGELOG.md > release_notes.md
           echo "Release notes:"
           cat release_notes.md
       
       - name: Create extension archive
         run: |
           cd EOMTemplateTools.extension
           zip -r ../EOMTemplateTools-${{ steps.get_version.outputs.VERSION }}.zip .
           cd ..
       
       - name: Create GitHub Release
         uses: softprops/action-gh-release@v1
         with:
           body_path: release_notes.md
           files: |
             EOMTemplateTools-${{ steps.get_version.outputs.VERSION }}.zip
           draft: false
           prerelease: ${{ contains(github.ref, 'alpha') || contains(github.ref, 'beta') || contains(github.ref, 'rc') }}
         env:
           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
