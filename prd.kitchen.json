{
  "project": "Kitchen Sockets Optimization",
  "branchName": "ralph/kitchen-sockets-perimeter-fix",
  "description": "Исправление алгоритма расстановки розеток на кухне: снятие лимита и смена направления обхода",
  "userStories": [
    {
      "id": "US-001",
      "title": "Снять лимит на количество розеток",
      "description": "Как пользователь, я хочу, чтобы в больших кухнях ставилось больше 1 розетки, чтобы покрыть всю площадь.",
      "acceptanceCriteria": [
        "Удален жесткий лимит min(need, 1)",
        "Количество розеток рассчитывается динамически (target - existing)"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Удален лимит и изменено направление обхода для всех типов розеток."
    },
    {
      "id": "US-002",
      "title": "Изменить направление обхода периметра",
      "description": "Как пользователь, я хочу, чтобы розетки расставлялись в другую сторону от гарнитура.",
      "acceptanceCriteria": [
        "Изменен порядок signs в offset_candidates",
        "Проверен алгоритм для всех типов розеток (sink, stove)"
      ],
      "priority": 2,
      "passes": true,
      "notes": "signs = [-1, 1]"
    },
    {
      "id": "US-003",
      "title": "Проверить логику general sockets",
      "description": "В скрипте есть отдельный блок для general sockets, возможно он тоже влияет на расстановку в больших комнатах.",
      "acceptanceCriteria": [
        "Проверить расчет general_sockets_count",
        "Проверить логику размещения general sockets"
      ],
      "priority": 3,
      "passes": true,
      "notes": "В domain.py перевернут обход периметра для general sockets, в script.py добавлена динамика количества."
    },
    {
      "id": "US-004",
      "title": "Улучшить сбор сегментов периметра",
      "description": "Алгоритм должен видеть все стены комнаты, а не останавливаться на первом проеме.",
      "acceptanceCriteria": [
        "calculate_perimeter_allowed_path не прерывается break",
        "Собираются все доступные сегменты",
        "Суммируется длина всех сегментов"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Доработан цикл сбора сегментов в domain.py: добавлен фильтр мебели (столы/стулья) и проверка дистанции."
    },
    {
      "id": "US-005",
      "title": "Fallback для одной розетки",
      "description": "Если после всех фильтров остается только 1 розетка, ставить её рядом с предыдущей (или в начало сегмента), чтобы не терялась.",
      "acceptanceCriteria": [
        "Если count == 1, размещаем корректно"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Реализовано в _generate_perimeter_candidates (min_spacing protection)"
    },
    {
      "id": "US-006",
      "title": "Добавить проверку отступов для General Sockets",
      "description": "Общие розетки не должны ставиться ближе 600мм к раковине и плите.",
      "acceptanceCriteria": [
        "В цикле general sockets есть проверка clear_sink_ft",
        "В цикле general sockets есть проверка clear_stove_ft"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Добавлено в script.py"
    },
    {
      "id": "US-007",
      "title": "Равномерное распределение розеток",
      "description": "Розетки должны распределяться равномерно по всему доступному периметру, а не кучковаться в начале.",
      "acceptanceCriteria": [
        "Используется формула step = total / (count + 1)",
        "Розетки покрывают всю длину периметра"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Реализовано в _generate_perimeter_candidates в domain.py (изменено на center distribution)"
    },
    {
      "id": "US-008",
      "title": "Расстановка по центрам отрезков и реверс",
      "description": "Изменить алгоритм на (i+0.5)*len/N и развернуть направление обхода.",
      "acceptanceCriteria": [
        "Формула (i+0.5) * segment_len",
        "allowed_path reversed"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Реализовано в domain.py"
    },
    {
      "id": "US-009",
      "title": "Отмена реверса направления",
      "description": "Вернуть прямой порядок обхода периметра, чтобы розетки встали вверх по схеме пользователя.",
      "acceptanceCriteria": [
        "Убран reversed() в generate_perimeter_candidates"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Возвращен прямой порядок path"
    },
    {
      "id": "US-010",
      "title": "Увеличить отступ от гарнитура",
      "description": "Розетки должны ставиться подальше от гарнитура (1200мм мертвая зона).",
      "acceptanceCriteria": [
        "unit_margin увеличен до 1200"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Увеличено в script.py"
    },
    {
      "id": "US-011",
      "title": "Откат отступа",
      "description": "Вернуть unit_margin на 100мм по просьбе пользователя.",
      "acceptanceCriteria": [
        "unit_margin = 100"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Возвращено значение 100"
    }
  ]
}
