 name: CI
 
 on:
   push:
     branches: [main]
   pull_request:
     branches: [main]
 
 jobs:
   lint-and-test:
     runs-on: ubuntu-latest
     
     steps:
       - uses: actions/checkout@v4
       
       - name: Set up Python
         uses: actions/setup-python@v5
         with:
           python-version: '3.11'
           cache: 'pip'
       
       - name: Install dependencies
         run: |
           python -m pip install --upgrade pip
           pip install -r requirements-dev.txt
       
       - name: Run flake8
         run: |
           flake8 EOMTemplateTools.extension/lib/ tests/
       
      - name: Run mypy
        run: |
          mypy EOMTemplateTools.extension/lib/utils_units.py EOMTemplateTools.extension/lib/text_utils.py EOMTemplateTools.extension/lib/config_loader.py EOMTemplateTools.extension/lib/pk_indicator_rules.py
      
       - name: Run pytest
         run: |
          pytest tests/ -v --cov=EOMTemplateTools.extension/lib --cov-report=term-missing --cov-report=html --cov-fail-under=80
      
      - name: Upload coverage report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: coverage-report
          path: htmlcov/
          retention-days: 7
